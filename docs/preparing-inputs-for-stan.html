<!DOCTYPE html>
<html lang="es" xml:lang="es">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.4 Preparing Inputs for STAN | Area-models-for-estimating-poverty-and-labor-market-indicators</title>
  <meta name="description" content="Area models for estimating poverty and labor market indicators" />
  <meta name="generator" content="bookdown 0.36 and GitBook 2.6.7" />

  <meta property="og:title" content="3.4 Preparing Inputs for STAN | Area-models-for-estimating-poverty-and-labor-market-indicators" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Area models for estimating poverty and labor market indicators" />
  <meta name="github-repo" content="psirusteam/HHS-Handbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.4 Preparing Inputs for STAN | Area-models-for-estimating-poverty-and-labor-market-indicators" />
  
  <meta name="twitter:description" content="Area models for estimating poverty and labor market indicators" />
  



<meta name="date" content="2023-12-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="modelos-de-área---transformación-arcoseno..html"/>
<link rel="next" href="poverty-map.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Area models for estimating poverty and labor market indicators</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Workshop material</a></li>
<li class="chapter" data-level="1" data-path="sesión-1--census-and-satellite-information.html"><a href="sesión-1--census-and-satellite-information.html"><i class="fa fa-check"></i><b>1</b> Sesión 1- Census and satellite information</a>
<ul>
<li class="chapter" data-level="1.1" data-path="use-of-satellite-imagery-and-sae.html"><a href="use-of-satellite-imagery-and-sae.html"><i class="fa fa-check"></i><b>1.1</b> Use of Satellite Imagery and SAE</a></li>
<li class="chapter" data-level="1.2" data-path="satellite-image-data-sources.html"><a href="satellite-image-data-sources.html"><i class="fa fa-check"></i><b>1.2</b> Satellite Image Data Sources</a></li>
<li class="chapter" data-level="1.3" data-path="google-earth-engine.html"><a href="google-earth-engine.html"><i class="fa fa-check"></i><b>1.3</b> Google Earth Engine</a></li>
<li class="chapter" data-level="1.4" data-path="installing-rgee.html"><a href="installing-rgee.html"><i class="fa fa-check"></i><b>1.4</b> Installing rgee</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="installing-rgee.html"><a href="installing-rgee.html#downloading-satellite-information"><i class="fa fa-check"></i><b>1.4.1</b> Downloading Satellite Information</a></li>
<li class="chapter" data-level="1.4.2" data-path="installing-rgee.html"><a href="installing-rgee.html#night-lights"><i class="fa fa-check"></i><b>1.4.2</b> Night Lights</a></li>
<li class="chapter" data-level="1.4.3" data-path="installing-rgee.html"><a href="installing-rgee.html#crop-cover"><i class="fa fa-check"></i><b>1.4.3</b> Crop Cover</a></li>
<li class="chapter" data-level="1.4.4" data-path="installing-rgee.html"><a href="installing-rgee.html#urban-cover"><i class="fa fa-check"></i><b>1.4.4</b> Urban Cover</a></li>
<li class="chapter" data-level="1.4.5" data-path="installing-rgee.html"><a href="installing-rgee.html#human-modification"><i class="fa fa-check"></i><b>1.4.5</b> Human Modification</a></li>
<li class="chapter" data-level="1.4.6" data-path="installing-rgee.html"><a href="installing-rgee.html#average-travel-time-to-hospital"><i class="fa fa-check"></i><b>1.4.6</b> Average Travel Time to Hospital</a></li>
<li class="chapter" data-level="1.4.7" data-path="installing-rgee.html"><a href="installing-rgee.html#average-travel-time-to-hospital-by-non-motorized-vehicle"><i class="fa fa-check"></i><b>1.4.7</b> Average Travel Time to Hospital by Non-Motorized Vehicle</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="population-and-housing-censuses.html"><a href="population-and-housing-censuses.html"><i class="fa fa-check"></i><b>1.5</b> Population and Housing Censuses</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="population-and-housing-censuses.html"><a href="population-and-housing-censuses.html#mapas-de-las-variables-con-información-censal."><i class="fa fa-check"></i><b>1.5.1</b> Mapas de las variables con información censal.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="session-2--generalized-variance-function.html"><a href="session-2--generalized-variance-function.html"><i class="fa fa-check"></i><b>2</b> Session 2- Generalized Variance Function</a>
<ul>
<li class="chapter" data-level="2.1" data-path="graphical-analysis.html"><a href="graphical-analysis.html"><i class="fa fa-check"></i><b>2.1</b> Graphical Analysis</a></li>
<li class="chapter" data-level="2.2" data-path="variance-model.html"><a href="variance-model.html"><i class="fa fa-check"></i><b>2.2</b> Variance Model</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="session-3--fay-herriot-model---poverty-estimation.html"><a href="session-3--fay-herriot-model---poverty-estimation.html"><i class="fa fa-check"></i><b>3</b> Session 3- Fay Herriot Model - Poverty Estimation</a>
<ul>
<li class="chapter" data-level="" data-path="session-3--fay-herriot-model---poverty-estimation.html"><a href="session-3--fay-herriot-model---poverty-estimation.html#area-model-for-poverty-estimation"><i class="fa fa-check"></i>Area Model for Poverty Estimation</a></li>
<li class="chapter" data-level="" data-path="session-3--fay-herriot-model---poverty-estimation.html"><a href="session-3--fay-herriot-model---poverty-estimation.html#optimal-predictor-of-p_d"><i class="fa fa-check"></i>Optimal Predictor of <span class="math inline">\(P_d\)</span></a></li>
<li class="chapter" data-level="3.1" data-path="estimation-procedure.html"><a href="estimation-procedure.html"><i class="fa fa-check"></i><b>3.1</b> Estimation Procedure</a></li>
<li class="chapter" data-level="3.2" data-path="preparing-the-supplies-for-stan.html"><a href="preparing-the-supplies-for-stan.html"><i class="fa fa-check"></i><b>3.2</b> Preparing the supplies for <code>STAN</code></a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="preparing-the-supplies-for-stan.html"><a href="preparing-the-supplies-for-stan.html#results-of-the-model-for-observed-domains."><i class="fa fa-check"></i><b>3.2.1</b> Results of the model for observed domains.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="modelos-de-área---transformación-arcoseno..html"><a href="modelos-de-área---transformación-arcoseno..html"><i class="fa fa-check"></i><b>3.3</b> Modelos de área - transformación ArcoSeno.</a></li>
<li class="chapter" data-level="3.4" data-path="preparing-inputs-for-stan.html"><a href="preparing-inputs-for-stan.html"><i class="fa fa-check"></i><b>3.4</b> Preparing Inputs for <code>STAN</code></a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="preparing-inputs-for-stan.html"><a href="preparing-inputs-for-stan.html#benchmark-process"><i class="fa fa-check"></i><b>3.4.1</b> Benchmark Process</a></li>
<li class="chapter" data-level="3.4.2" data-path="preparing-inputs-for-stan.html"><a href="preparing-inputs-for-stan.html#results-validation"><i class="fa fa-check"></i><b>3.4.2</b> Results Validation</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="poverty-map.html"><a href="poverty-map.html"><i class="fa fa-check"></i><b>3.5</b> Poverty Map</a></li>
</ul></li>
<li class="divider"></li>
<li><a Area models for estimating poverty and labor market indicators </a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="preparing-inputs-for-stan" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Preparing Inputs for <code>STAN</code><a href="preparing-inputs-for-stan.html#preparing-inputs-for-stan" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>Splitting the database into observed and unobserved domains</li>
</ol>
<p>Observed domains.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="preparing-inputs-for-stan.html#cb41-1" tabindex="-1"></a>data_dir <span class="ot">&lt;-</span> base_FH <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(T_pobreza))</span></code></pre></div>
<p>Unobserved domains.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="preparing-inputs-for-stan.html#cb42-1" tabindex="-1"></a>data_syn <span class="ot">&lt;-</span></span>
<span id="cb42-2"><a href="preparing-inputs-for-stan.html#cb42-2" tabindex="-1"></a>  base_FH <span class="sc">%&gt;%</span> <span class="fu">anti_join</span>(data_dir <span class="sc">%&gt;%</span> <span class="fu">select</span>(dam2))</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Defining the fixed-effects matrix.</li>
</ol>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="preparing-inputs-for-stan.html#cb43-1" tabindex="-1"></a><span class="do">## Observed domains</span></span>
<span id="cb43-2"><a href="preparing-inputs-for-stan.html#cb43-2" tabindex="-1"></a>Xdat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">inter =</span> <span class="dv">1</span>,data_dir[,names_cov])</span>
<span id="cb43-3"><a href="preparing-inputs-for-stan.html#cb43-3" tabindex="-1"></a></span>
<span id="cb43-4"><a href="preparing-inputs-for-stan.html#cb43-4" tabindex="-1"></a><span class="do">## Unobserved domains</span></span>
<span id="cb43-5"><a href="preparing-inputs-for-stan.html#cb43-5" tabindex="-1"></a>Xs <span class="ot">&lt;-</span>  <span class="fu">cbind</span>(<span class="at">inter =</span> <span class="dv">1</span>,data_syn[,names_cov])</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Creating a parameter list for <code>STAN</code>.</li>
</ol>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="preparing-inputs-for-stan.html#cb44-1" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb44-2"><a href="preparing-inputs-for-stan.html#cb44-2" tabindex="-1"></a>  <span class="at">N1 =</span> <span class="fu">nrow</span>(Xdat),       <span class="co"># Observed.</span></span>
<span id="cb44-3"><a href="preparing-inputs-for-stan.html#cb44-3" tabindex="-1"></a>  <span class="at">N2 =</span> <span class="fu">nrow</span>(Xs),         <span class="co"># Unobserved.</span></span>
<span id="cb44-4"><a href="preparing-inputs-for-stan.html#cb44-4" tabindex="-1"></a>  <span class="at">p  =</span> <span class="fu">ncol</span>(Xdat),       <span class="co"># Number of regressors.</span></span>
<span id="cb44-5"><a href="preparing-inputs-for-stan.html#cb44-5" tabindex="-1"></a>  <span class="at">X  =</span> <span class="fu">as.matrix</span>(Xdat),  <span class="co"># Observed Covariates.</span></span>
<span id="cb44-6"><a href="preparing-inputs-for-stan.html#cb44-6" tabindex="-1"></a>  <span class="at">Xs =</span> <span class="fu">as.matrix</span>(Xs),    <span class="co"># Unobserved Covariates</span></span>
<span id="cb44-7"><a href="preparing-inputs-for-stan.html#cb44-7" tabindex="-1"></a>  <span class="at">y  =</span> <span class="fu">as.numeric</span>(data_dir<span class="sc">$</span>T_pobreza),</span>
<span id="cb44-8"><a href="preparing-inputs-for-stan.html#cb44-8" tabindex="-1"></a>  <span class="at">sigma_e =</span> <span class="fu">sqrt</span>(data_dir<span class="sc">$</span>varhat)</span>
<span id="cb44-9"><a href="preparing-inputs-for-stan.html#cb44-9" tabindex="-1"></a>)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Compiling the model in <code>STAN</code>.</li>
</ol>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="preparing-inputs-for-stan.html#cb45-1" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb45-2"><a href="preparing-inputs-for-stan.html#cb45-2" tabindex="-1"></a>fit_FH_arcoseno <span class="ot">&lt;-</span> <span class="st">&quot;Recursos/04_FH_Arcosin/modelosStan/15FH_arcsin_normal.stan&quot;</span></span>
<span id="cb45-3"><a href="preparing-inputs-for-stan.html#cb45-3" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb45-4"><a href="preparing-inputs-for-stan.html#cb45-4" tabindex="-1"></a>rstan<span class="sc">::</span><span class="fu">rstan_options</span>(<span class="at">auto_write =</span> <span class="cn">TRUE</span>) <span class="co"># speed up running time </span></span>
<span id="cb45-5"><a href="preparing-inputs-for-stan.html#cb45-5" tabindex="-1"></a>model_FH_arcoseno <span class="ot">&lt;-</span> <span class="fu">stan</span>(</span>
<span id="cb45-6"><a href="preparing-inputs-for-stan.html#cb45-6" tabindex="-1"></a>  <span class="at">file =</span> fit_FH_arcoseno,  </span>
<span id="cb45-7"><a href="preparing-inputs-for-stan.html#cb45-7" tabindex="-1"></a>  <span class="at">data =</span> sample_data,   </span>
<span id="cb45-8"><a href="preparing-inputs-for-stan.html#cb45-8" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb45-9"><a href="preparing-inputs-for-stan.html#cb45-9" tabindex="-1"></a>  <span class="at">warmup =</span> <span class="dv">2500</span>,         </span>
<span id="cb45-10"><a href="preparing-inputs-for-stan.html#cb45-10" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">3000</span>,            </span>
<span id="cb45-11"><a href="preparing-inputs-for-stan.html#cb45-11" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>              </span>
<span id="cb45-12"><a href="preparing-inputs-for-stan.html#cb45-12" tabindex="-1"></a>)</span>
<span id="cb45-13"><a href="preparing-inputs-for-stan.html#cb45-13" tabindex="-1"></a><span class="fu">saveRDS</span>(model_FH_arcoseno,</span>
<span id="cb45-14"><a href="preparing-inputs-for-stan.html#cb45-14" tabindex="-1"></a>        <span class="st">&quot;Recursos/04_FH_Arcosin/02_model_FH_arcoseno.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="preparing-inputs-for-stan.html#cb46-1" tabindex="-1"></a>model_FH_arcoseno <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;Recursos/04_FH_Arcosin/02_model_FH_arcoseno.rds&quot;</span>)</span></code></pre></div>
<div id="resultados-del-modelo-para-los-dominios-observados." class="section level4 hasAnchor" number="3.4.0.1">
<h4><span class="header-section-number">3.4.0.1</span> Resultados del modelo para los dominios observados.<a href="preparing-inputs-for-stan.html#resultados-del-modelo-para-los-dominios-observados." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="preparing-inputs-for-stan.html#cb47-1" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb47-2"><a href="preparing-inputs-for-stan.html#cb47-2" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb47-3"><a href="preparing-inputs-for-stan.html#cb47-3" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb47-4"><a href="preparing-inputs-for-stan.html#cb47-4" tabindex="-1"></a></span>
<span id="cb47-5"><a href="preparing-inputs-for-stan.html#cb47-5" tabindex="-1"></a>y_pred_B <span class="ot">&lt;-</span> <span class="fu">as.array</span>(model_FH_arcoseno, <span class="at">pars =</span> <span class="st">&quot;theta&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb47-6"><a href="preparing-inputs-for-stan.html#cb47-6" tabindex="-1"></a>  <span class="fu">as_draws_matrix</span>()</span>
<span id="cb47-7"><a href="preparing-inputs-for-stan.html#cb47-7" tabindex="-1"></a>rowsrandom <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(y_pred_B), <span class="dv">100</span>)</span>
<span id="cb47-8"><a href="preparing-inputs-for-stan.html#cb47-8" tabindex="-1"></a></span>
<span id="cb47-9"><a href="preparing-inputs-for-stan.html#cb47-9" tabindex="-1"></a>y_pred2 <span class="ot">&lt;-</span> y_pred_B[rowsrandom, ]</span>
<span id="cb47-10"><a href="preparing-inputs-for-stan.html#cb47-10" tabindex="-1"></a><span class="fu">ppc_dens_overlay</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(data_dir<span class="sc">$</span>pobreza), y_pred2)</span></code></pre></div>
<p><img src="Recursos/04_FH_Arcosin/03_ppc_Arcosin.png" /></p>
<p>Graphical analysis of the convergence of <span class="math inline">\(\sigma^2_u\)</span> chains.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="preparing-inputs-for-stan.html#cb48-1" tabindex="-1"></a>posterior_sigma2_u <span class="ot">&lt;-</span> <span class="fu">as.array</span>(model_FH_arcoseno, <span class="at">pars =</span> <span class="st">&quot;sigma2_u&quot;</span>)</span>
<span id="cb48-2"><a href="preparing-inputs-for-stan.html#cb48-2" tabindex="-1"></a>(<span class="fu">mcmc_dens_chains</span>(posterior_sigma2_u) <span class="sc">+</span></span>
<span id="cb48-3"><a href="preparing-inputs-for-stan.html#cb48-3" tabindex="-1"></a>    <span class="fu">mcmc_areas</span>(posterior_sigma2_u) ) <span class="sc">/</span> </span>
<span id="cb48-4"><a href="preparing-inputs-for-stan.html#cb48-4" tabindex="-1"></a>  <span class="fu">mcmc_trace</span>(posterior_sigma2_u)</span></code></pre></div>
<p><img src="Recursos/04_FH_Arcosin/04_sigma2.png" /></p>
<p>Para validar la convergencia de todas las cadenas se hace uso del <em>R-hat</em>.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="preparing-inputs-for-stan.html#cb49-1" tabindex="-1"></a>parametros <span class="ot">&lt;-</span> <span class="fu">summary</span>(model_FH_arcoseno, <span class="at">pars =</span>  <span class="fu">c</span>(<span class="st">&quot;theta&quot;</span>, <span class="st">&quot;theta_pred&quot;</span>) )<span class="sc">$</span>summary <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="preparing-inputs-for-stan.html#cb49-2" tabindex="-1"></a>  <span class="fu">data.frame</span>()</span>
<span id="cb49-3"><a href="preparing-inputs-for-stan.html#cb49-3" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">mcmc_rhat</span>(parametros<span class="sc">$</span>Rhat)</span>
<span id="cb49-4"><a href="preparing-inputs-for-stan.html#cb49-4" tabindex="-1"></a>p1</span></code></pre></div>
<p><img src="Recursos/04_FH_Arcosin/05_Rhat.png" /></p>
<p>Estimation of the FH of poverty in the observed domains.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="preparing-inputs-for-stan.html#cb50-1" tabindex="-1"></a>theta_FH <span class="ot">&lt;-</span>   <span class="fu">summary</span>(model_FH_arcoseno,<span class="at">pars =</span>  <span class="st">&quot;theta&quot;</span>)<span class="sc">$</span>summary <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="preparing-inputs-for-stan.html#cb50-2" tabindex="-1"></a>  <span class="fu">data.frame</span>()</span>
<span id="cb50-3"><a href="preparing-inputs-for-stan.html#cb50-3" tabindex="-1"></a>data_dir <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">pred_arcoseno =</span> theta_FH<span class="sc">$</span>mean, </span>
<span id="cb50-4"><a href="preparing-inputs-for-stan.html#cb50-4" tabindex="-1"></a>                     <span class="at">pred_arcoseno_EE =</span> theta_FH<span class="sc">$</span>sd,</span>
<span id="cb50-5"><a href="preparing-inputs-for-stan.html#cb50-5" tabindex="-1"></a>                     <span class="at">Cv_pred =</span> pred_arcoseno_EE<span class="sc">/</span>pred_arcoseno)</span></code></pre></div>
<p>Estimation of the FH of poverty in the NOT observed domains.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="preparing-inputs-for-stan.html#cb51-1" tabindex="-1"></a>theta_FH_pred <span class="ot">&lt;-</span> <span class="fu">summary</span>(model_FH_arcoseno,<span class="at">pars =</span>  <span class="st">&quot;theta_pred&quot;</span>)<span class="sc">$</span>summary <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="preparing-inputs-for-stan.html#cb51-2" tabindex="-1"></a>  <span class="fu">data.frame</span>()</span>
<span id="cb51-3"><a href="preparing-inputs-for-stan.html#cb51-3" tabindex="-1"></a>data_syn <span class="ot">&lt;-</span> data_syn <span class="sc">%&gt;%</span> </span>
<span id="cb51-4"><a href="preparing-inputs-for-stan.html#cb51-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred_arcoseno =</span> theta_FH_pred<span class="sc">$</span>mean,</span>
<span id="cb51-5"><a href="preparing-inputs-for-stan.html#cb51-5" tabindex="-1"></a>         <span class="at">pred_arcoseno_EE =</span> theta_FH_pred<span class="sc">$</span>sd,</span>
<span id="cb51-6"><a href="preparing-inputs-for-stan.html#cb51-6" tabindex="-1"></a>         <span class="at">Cv_pred =</span> pred_arcoseno_EE<span class="sc">/</span>pred_arcoseno)</span></code></pre></div>
<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
dam2
</th>
<th style="text-align:right;">
pobreza
</th>
<th style="text-align:right;">
pred_arcoseno
</th>
<th style="text-align:right;">
pred_arcoseno_EE
</th>
<th style="text-align:right;">
Cv_pred
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
0101
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.8630
</td>
<td style="text-align:right;">
0.1463
</td>
<td style="text-align:right;">
0.1696
</td>
</tr>
<tr>
<td style="text-align:left;">
0201
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.8797
</td>
<td style="text-align:right;">
0.1426
</td>
<td style="text-align:right;">
0.1621
</td>
</tr>
<tr>
<td style="text-align:left;">
0204
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.8412
</td>
<td style="text-align:right;">
0.1592
</td>
<td style="text-align:right;">
0.1893
</td>
</tr>
<tr>
<td style="text-align:left;">
0206
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.8980
</td>
<td style="text-align:right;">
0.1296
</td>
<td style="text-align:right;">
0.1443
</td>
</tr>
<tr>
<td style="text-align:left;">
0207
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.8958
</td>
<td style="text-align:right;">
0.1321
</td>
<td style="text-align:right;">
0.1475
</td>
</tr>
<tr>
<td style="text-align:left;">
0208
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.7818
</td>
<td style="text-align:right;">
0.1893
</td>
<td style="text-align:right;">
0.2421
</td>
</tr>
<tr>
<td style="text-align:left;">
0209
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.8910
</td>
<td style="text-align:right;">
0.1313
</td>
<td style="text-align:right;">
0.1474
</td>
</tr>
<tr>
<td style="text-align:left;">
0210
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.8990
</td>
<td style="text-align:right;">
0.1290
</td>
<td style="text-align:right;">
0.1435
</td>
</tr>
<tr>
<td style="text-align:left;">
0211
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.8872
</td>
<td style="text-align:right;">
0.1389
</td>
<td style="text-align:right;">
0.1566
</td>
</tr>
<tr>
<td style="text-align:left;">
0502
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.7649
</td>
<td style="text-align:right;">
0.1889
</td>
<td style="text-align:right;">
0.2470
</td>
</tr>
</tbody>
</table>
<p>consolidating the bases of estimates for observed and UNobserved domains.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="preparing-inputs-for-stan.html#cb52-1" tabindex="-1"></a>estimacionesPre <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(data_dir, data_syn) <span class="sc">%&gt;%</span> </span>
<span id="cb52-2"><a href="preparing-inputs-for-stan.html#cb52-2" tabindex="-1"></a>  <span class="fu">select</span>(dam2, <span class="at">theta_pred =</span> pred_arcoseno) <span class="sc">%&gt;%</span> </span>
<span id="cb52-3"><a href="preparing-inputs-for-stan.html#cb52-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dam =</span> <span class="fu">substr</span>(dam2,<span class="dv">1</span>,<span class="dv">2</span>))</span></code></pre></div>
</div>
<div id="benchmark-process" class="section level3 hasAnchor" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> Benchmark Process<a href="preparing-inputs-for-stan.html#benchmark-process" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>From the census extract the total number of people by DAM2</li>
</ol>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="preparing-inputs-for-stan.html#cb53-1" tabindex="-1"></a>total_pp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">&quot;Recursos/04_FH_Arcosin/06_censo_mrp.rds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="preparing-inputs-for-stan.html#cb53-2" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">dam =</span> <span class="fu">substr</span>(dam2,<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb53-3"><a href="preparing-inputs-for-stan.html#cb53-3" tabindex="-1"></a></span>
<span id="cb53-4"><a href="preparing-inputs-for-stan.html#cb53-4" tabindex="-1"></a></span>
<span id="cb53-5"><a href="preparing-inputs-for-stan.html#cb53-5" tabindex="-1"></a>N_dam_pp <span class="ot">&lt;-</span> total_pp <span class="sc">%&gt;%</span>   <span class="fu">group_by</span>(dam,dam2) <span class="sc">%&gt;%</span>  </span>
<span id="cb53-6"><a href="preparing-inputs-for-stan.html#cb53-6" tabindex="-1"></a>            <span class="fu">summarise</span>(<span class="at">total_pp =</span> <span class="fu">sum</span>(n) ) <span class="sc">%&gt;%</span> </span>
<span id="cb53-7"><a href="preparing-inputs-for-stan.html#cb53-7" tabindex="-1"></a>  <span class="fu">group_by</span>(dam) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">dam_pp =</span> <span class="fu">sum</span>(total_pp))</span>
<span id="cb53-8"><a href="preparing-inputs-for-stan.html#cb53-8" tabindex="-1"></a></span>
<span id="cb53-9"><a href="preparing-inputs-for-stan.html#cb53-9" tabindex="-1"></a><span class="fu">tba</span>(N_dam_pp <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span></code></pre></div>
<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
dam
</th>
<th style="text-align:left;">
dam2
</th>
<th style="text-align:right;">
total_pp
</th>
<th style="text-align:right;">
dam_pp
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
01
</td>
<td style="text-align:left;">
0101
</td>
<td style="text-align:right;">
35750
</td>
<td style="text-align:right;">
88799
</td>
</tr>
<tr>
<td style="text-align:left;">
01
</td>
<td style="text-align:left;">
0102
</td>
<td style="text-align:right;">
26458
</td>
<td style="text-align:right;">
88799
</td>
</tr>
<tr>
<td style="text-align:left;">
01
</td>
<td style="text-align:left;">
0103
</td>
<td style="text-align:right;">
26591
</td>
<td style="text-align:right;">
88799
</td>
</tr>
<tr>
<td style="text-align:left;">
02
</td>
<td style="text-align:left;">
0201
</td>
<td style="text-align:right;">
58937
</td>
<td style="text-align:right;">
573065
</td>
</tr>
<tr>
<td style="text-align:left;">
02
</td>
<td style="text-align:left;">
0202
</td>
<td style="text-align:right;">
43700
</td>
<td style="text-align:right;">
573065
</td>
</tr>
<tr>
<td style="text-align:left;">
02
</td>
<td style="text-align:left;">
0203
</td>
<td style="text-align:right;">
35309
</td>
<td style="text-align:right;">
573065
</td>
</tr>
<tr>
<td style="text-align:left;">
02
</td>
<td style="text-align:left;">
0204
</td>
<td style="text-align:right;">
47230
</td>
<td style="text-align:right;">
573065
</td>
</tr>
<tr>
<td style="text-align:left;">
02
</td>
<td style="text-align:left;">
0205
</td>
<td style="text-align:right;">
35694
</td>
<td style="text-align:right;">
573065
</td>
</tr>
<tr>
<td style="text-align:left;">
02
</td>
<td style="text-align:left;">
0206
</td>
<td style="text-align:right;">
38832
</td>
<td style="text-align:right;">
573065
</td>
</tr>
<tr>
<td style="text-align:left;">
02
</td>
<td style="text-align:left;">
0207
</td>
<td style="text-align:right;">
42103
</td>
<td style="text-align:right;">
573065
</td>
</tr>
</tbody>
</table>
<ol start="2" style="list-style-type: decimal">
<li>Obtaining direct estimates by DAM or the level of aggregation at which the survey is representative.</li>
</ol>
<p>In this code, an RDS file of a survey (<code>07_data_JAM.rds</code>) is read, and the <code>transmute()</code> function is used to select and transform the variables of interest.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="preparing-inputs-for-stan.html#cb54-1" tabindex="-1"></a>encuesta <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;Recursos/04_FH_Arcosin/07_encuesta.rds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb54-2"><a href="preparing-inputs-for-stan.html#cb54-2" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">dam =</span> <span class="fu">substr</span>(dam2,<span class="dv">1</span>,<span class="dv">2</span>))</span></code></pre></div>
<p>The code is conducting survey data analysis using the <code>survey</code> package in R. Initially, an object <code>design</code> is created as a survey design using the <code>as_survey_design()</code> function from the <code>srvyr</code> package. This design includes primary sampling unit identifiers (<code>upm</code>), weights (<code>fep</code>), strata (<code>estrato</code>), and survey data (<code>encuesta</code>). Subsequently, the <code>design</code> object is grouped by the variable “Aggregate,” and the mean of the variable “pobreza” with a confidence interval for the entire population is calculated using the <code>survey_mean()</code> function. The result is stored in the <code>directoDam</code> object and displayed in a table.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="preparing-inputs-for-stan.html#cb55-1" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb55-2"><a href="preparing-inputs-for-stan.html#cb55-2" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span>
<span id="cb55-3"><a href="preparing-inputs-for-stan.html#cb55-3" tabindex="-1"></a><span class="fu">options</span>(<span class="at">survey.lonely.psu =</span> <span class="st">&quot;adjust&quot;</span>)</span>
<span id="cb55-4"><a href="preparing-inputs-for-stan.html#cb55-4" tabindex="-1"></a></span>
<span id="cb55-5"><a href="preparing-inputs-for-stan.html#cb55-5" tabindex="-1"></a>diseno <span class="ot">&lt;-</span></span>
<span id="cb55-6"><a href="preparing-inputs-for-stan.html#cb55-6" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(</span>
<span id="cb55-7"><a href="preparing-inputs-for-stan.html#cb55-7" tabindex="-1"></a>    <span class="at">ids =</span> upm,</span>
<span id="cb55-8"><a href="preparing-inputs-for-stan.html#cb55-8" tabindex="-1"></a>    <span class="at">weights =</span> fep,</span>
<span id="cb55-9"><a href="preparing-inputs-for-stan.html#cb55-9" tabindex="-1"></a>    <span class="at">strata =</span> estrato,</span>
<span id="cb55-10"><a href="preparing-inputs-for-stan.html#cb55-10" tabindex="-1"></a>    <span class="at">nest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb55-11"><a href="preparing-inputs-for-stan.html#cb55-11" tabindex="-1"></a>    <span class="at">.data =</span> encuesta</span>
<span id="cb55-12"><a href="preparing-inputs-for-stan.html#cb55-12" tabindex="-1"></a>  )</span>
<span id="cb55-13"><a href="preparing-inputs-for-stan.html#cb55-13" tabindex="-1"></a>directoDam <span class="ot">&lt;-</span> diseno <span class="sc">%&gt;%</span> </span>
<span id="cb55-14"><a href="preparing-inputs-for-stan.html#cb55-14" tabindex="-1"></a>    <span class="fu">group_by</span>(dam) <span class="sc">%&gt;%</span> </span>
<span id="cb55-15"><a href="preparing-inputs-for-stan.html#cb55-15" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb55-16"><a href="preparing-inputs-for-stan.html#cb55-16" tabindex="-1"></a>    <span class="at">theta_dir =</span> <span class="fu">survey_mean</span>(pobreza, <span class="at">vartype =</span> <span class="fu">c</span>(<span class="st">&quot;ci&quot;</span>))</span>
<span id="cb55-17"><a href="preparing-inputs-for-stan.html#cb55-17" tabindex="-1"></a>    )</span>
<span id="cb55-18"><a href="preparing-inputs-for-stan.html#cb55-18" tabindex="-1"></a><span class="fu">tba</span>(directoDam <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span></code></pre></div>
<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
dam
</th>
<th style="text-align:right;">
theta_dir
</th>
<th style="text-align:right;">
theta_dir_low
</th>
<th style="text-align:right;">
theta_dir_upp
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
01
</td>
<td style="text-align:right;">
0.9926
</td>
<td style="text-align:right;">
0.9848
</td>
<td style="text-align:right;">
1.0004
</td>
</tr>
<tr>
<td style="text-align:left;">
02
</td>
<td style="text-align:right;">
0.9760
</td>
<td style="text-align:right;">
0.9638
</td>
<td style="text-align:right;">
0.9881
</td>
</tr>
<tr>
<td style="text-align:left;">
03
</td>
<td style="text-align:right;">
0.9191
</td>
<td style="text-align:right;">
0.8566
</td>
<td style="text-align:right;">
0.9816
</td>
</tr>
<tr>
<td style="text-align:left;">
04
</td>
<td style="text-align:right;">
0.8160
</td>
<td style="text-align:right;">
0.7742
</td>
<td style="text-align:right;">
0.8578
</td>
</tr>
<tr>
<td style="text-align:left;">
05
</td>
<td style="text-align:right;">
0.7486
</td>
<td style="text-align:right;">
0.6943
</td>
<td style="text-align:right;">
0.8029
</td>
</tr>
<tr>
<td style="text-align:left;">
06
</td>
<td style="text-align:right;">
0.9419
</td>
<td style="text-align:right;">
0.8993
</td>
<td style="text-align:right;">
0.9844
</td>
</tr>
<tr>
<td style="text-align:left;">
07
</td>
<td style="text-align:right;">
0.8019
</td>
<td style="text-align:right;">
0.7076
</td>
<td style="text-align:right;">
0.8962
</td>
</tr>
<tr>
<td style="text-align:left;">
08
</td>
<td style="text-align:right;">
0.5933
</td>
<td style="text-align:right;">
0.4904
</td>
<td style="text-align:right;">
0.6961
</td>
</tr>
<tr>
<td style="text-align:left;">
09
</td>
<td style="text-align:right;">
0.8628
</td>
<td style="text-align:right;">
0.8167
</td>
<td style="text-align:right;">
0.9090
</td>
</tr>
<tr>
<td style="text-align:left;">
10
</td>
<td style="text-align:right;">
0.7379
</td>
<td style="text-align:right;">
0.6348
</td>
<td style="text-align:right;">
0.8410
</td>
</tr>
</tbody>
</table>
<ol start="3" style="list-style-type: decimal">
<li>Carry out the consolidation of information obtained in <em>1</em> and <em>2</em>.</li>
</ol>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="preparing-inputs-for-stan.html#cb56-1" tabindex="-1"></a>temp <span class="ot">&lt;-</span> estimacionesPre <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="preparing-inputs-for-stan.html#cb56-2" tabindex="-1"></a>  <span class="fu">inner_join</span>(N_dam_pp ) <span class="sc">%&gt;%</span> </span>
<span id="cb56-3"><a href="preparing-inputs-for-stan.html#cb56-3" tabindex="-1"></a>  <span class="fu">inner_join</span>(directoDam )</span>
<span id="cb56-4"><a href="preparing-inputs-for-stan.html#cb56-4" tabindex="-1"></a></span>
<span id="cb56-5"><a href="preparing-inputs-for-stan.html#cb56-5" tabindex="-1"></a><span class="fu">tba</span>(temp <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span></code></pre></div>
<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
dam2
</th>
<th style="text-align:right;">
theta_pred
</th>
<th style="text-align:left;">
dam
</th>
<th style="text-align:right;">
total_pp
</th>
<th style="text-align:right;">
dam_pp
</th>
<th style="text-align:right;">
theta_dir
</th>
<th style="text-align:right;">
theta_dir_low
</th>
<th style="text-align:right;">
theta_dir_upp
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
0102
</td>
<td style="text-align:right;">
0.9832
</td>
<td style="text-align:left;">
01
</td>
<td style="text-align:right;">
26458
</td>
<td style="text-align:right;">
88799
</td>
<td style="text-align:right;">
0.9926
</td>
<td style="text-align:right;">
0.9848
</td>
<td style="text-align:right;">
1.0004
</td>
</tr>
<tr>
<td style="text-align:left;">
0103
</td>
<td style="text-align:right;">
0.8759
</td>
<td style="text-align:left;">
01
</td>
<td style="text-align:right;">
26591
</td>
<td style="text-align:right;">
88799
</td>
<td style="text-align:right;">
0.9926
</td>
<td style="text-align:right;">
0.9848
</td>
<td style="text-align:right;">
1.0004
</td>
</tr>
<tr>
<td style="text-align:left;">
0202
</td>
<td style="text-align:right;">
0.9391
</td>
<td style="text-align:left;">
02
</td>
<td style="text-align:right;">
43700
</td>
<td style="text-align:right;">
573065
</td>
<td style="text-align:right;">
0.9760
</td>
<td style="text-align:right;">
0.9638
</td>
<td style="text-align:right;">
0.9881
</td>
</tr>
<tr>
<td style="text-align:left;">
0203
</td>
<td style="text-align:right;">
0.8117
</td>
<td style="text-align:left;">
02
</td>
<td style="text-align:right;">
35309
</td>
<td style="text-align:right;">
573065
</td>
<td style="text-align:right;">
0.9760
</td>
<td style="text-align:right;">
0.9638
</td>
<td style="text-align:right;">
0.9881
</td>
</tr>
<tr>
<td style="text-align:left;">
0205
</td>
<td style="text-align:right;">
0.9645
</td>
<td style="text-align:left;">
02
</td>
<td style="text-align:right;">
35694
</td>
<td style="text-align:right;">
573065
</td>
<td style="text-align:right;">
0.9760
</td>
<td style="text-align:right;">
0.9638
</td>
<td style="text-align:right;">
0.9881
</td>
</tr>
<tr>
<td style="text-align:left;">
0212
</td>
<td style="text-align:right;">
0.8303
</td>
<td style="text-align:left;">
02
</td>
<td style="text-align:right;">
58509
</td>
<td style="text-align:right;">
573065
</td>
<td style="text-align:right;">
0.9760
</td>
<td style="text-align:right;">
0.9638
</td>
<td style="text-align:right;">
0.9881
</td>
</tr>
<tr>
<td style="text-align:left;">
0301
</td>
<td style="text-align:right;">
0.9419
</td>
<td style="text-align:left;">
03
</td>
<td style="text-align:right;">
41762
</td>
<td style="text-align:right;">
93896
</td>
<td style="text-align:right;">
0.9191
</td>
<td style="text-align:right;">
0.8566
</td>
<td style="text-align:right;">
0.9816
</td>
</tr>
<tr>
<td style="text-align:left;">
0302
</td>
<td style="text-align:right;">
0.9109
</td>
<td style="text-align:left;">
03
</td>
<td style="text-align:right;">
52134
</td>
<td style="text-align:right;">
93896
</td>
<td style="text-align:right;">
0.9191
</td>
<td style="text-align:right;">
0.8566
</td>
<td style="text-align:right;">
0.9816
</td>
</tr>
<tr>
<td style="text-align:left;">
0401
</td>
<td style="text-align:right;">
0.8079
</td>
<td style="text-align:left;">
04
</td>
<td style="text-align:right;">
49909
</td>
<td style="text-align:right;">
81732
</td>
<td style="text-align:right;">
0.8160
</td>
<td style="text-align:right;">
0.7742
</td>
<td style="text-align:right;">
0.8578
</td>
</tr>
<tr>
<td style="text-align:left;">
0402
</td>
<td style="text-align:right;">
0.8307
</td>
<td style="text-align:left;">
04
</td>
<td style="text-align:right;">
31823
</td>
<td style="text-align:right;">
81732
</td>
<td style="text-align:right;">
0.8160
</td>
<td style="text-align:right;">
0.7742
</td>
<td style="text-align:right;">
0.8578
</td>
</tr>
</tbody>
</table>
<ol start="4" style="list-style-type: decimal">
<li>With the organized information, calculate the weights for the Benchmark</li>
</ol>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="preparing-inputs-for-stan.html#cb57-1" tabindex="-1"></a>R_dam2 <span class="ot">&lt;-</span> temp <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(dam) <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="preparing-inputs-for-stan.html#cb57-2" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb57-3"><a href="preparing-inputs-for-stan.html#cb57-3" tabindex="-1"></a>  <span class="at">R_dam_RB =</span> <span class="fu">unique</span>(theta_dir) <span class="sc">/</span> <span class="fu">sum</span>((total_pp  <span class="sc">/</span> dam_pp) <span class="sc">*</span> theta_pred)</span>
<span id="cb57-4"><a href="preparing-inputs-for-stan.html#cb57-4" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb57-5"><a href="preparing-inputs-for-stan.html#cb57-5" tabindex="-1"></a>  <span class="fu">left_join</span>(directoDam, <span class="at">by =</span> <span class="st">&quot;dam&quot;</span>)</span>
<span id="cb57-6"><a href="preparing-inputs-for-stan.html#cb57-6" tabindex="-1"></a></span>
<span id="cb57-7"><a href="preparing-inputs-for-stan.html#cb57-7" tabindex="-1"></a><span class="fu">tba</span>(R_dam2 <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(R_dam_RB)))</span></code></pre></div>
<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
dam
</th>
<th style="text-align:right;">
R_dam_RB
</th>
<th style="text-align:right;">
theta_dir
</th>
<th style="text-align:right;">
theta_dir_low
</th>
<th style="text-align:right;">
theta_dir_upp
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
13
</td>
<td style="text-align:right;">
1.1793
</td>
<td style="text-align:right;">
0.6461
</td>
<td style="text-align:right;">
0.5226
</td>
<td style="text-align:right;">
0.7696
</td>
</tr>
<tr>
<td style="text-align:left;">
02
</td>
<td style="text-align:right;">
1.1158
</td>
<td style="text-align:right;">
0.9760
</td>
<td style="text-align:right;">
0.9638
</td>
<td style="text-align:right;">
0.9881
</td>
</tr>
<tr>
<td style="text-align:left;">
01
</td>
<td style="text-align:right;">
1.0996
</td>
<td style="text-align:right;">
0.9926
</td>
<td style="text-align:right;">
0.9848
</td>
<td style="text-align:right;">
1.0004
</td>
</tr>
<tr>
<td style="text-align:left;">
09
</td>
<td style="text-align:right;">
1.0669
</td>
<td style="text-align:right;">
0.8628
</td>
<td style="text-align:right;">
0.8167
</td>
<td style="text-align:right;">
0.9090
</td>
</tr>
<tr>
<td style="text-align:left;">
14
</td>
<td style="text-align:right;">
1.0550
</td>
<td style="text-align:right;">
0.8792
</td>
<td style="text-align:right;">
0.8376
</td>
<td style="text-align:right;">
0.9207
</td>
</tr>
<tr>
<td style="text-align:left;">
10
</td>
<td style="text-align:right;">
1.0465
</td>
<td style="text-align:right;">
0.7379
</td>
<td style="text-align:right;">
0.6348
</td>
<td style="text-align:right;">
0.8410
</td>
</tr>
<tr>
<td style="text-align:left;">
05
</td>
<td style="text-align:right;">
1.0098
</td>
<td style="text-align:right;">
0.7486
</td>
<td style="text-align:right;">
0.6943
</td>
<td style="text-align:right;">
0.8029
</td>
</tr>
<tr>
<td style="text-align:left;">
06
</td>
<td style="text-align:right;">
1.0031
</td>
<td style="text-align:right;">
0.9419
</td>
<td style="text-align:right;">
0.8993
</td>
<td style="text-align:right;">
0.9844
</td>
</tr>
<tr>
<td style="text-align:left;">
04
</td>
<td style="text-align:right;">
0.9991
</td>
<td style="text-align:right;">
0.8160
</td>
<td style="text-align:right;">
0.7742
</td>
<td style="text-align:right;">
0.8578
</td>
</tr>
<tr>
<td style="text-align:left;">
08
</td>
<td style="text-align:right;">
0.9973
</td>
<td style="text-align:right;">
0.5933
</td>
<td style="text-align:right;">
0.4904
</td>
<td style="text-align:right;">
0.6961
</td>
</tr>
<tr>
<td style="text-align:left;">
03
</td>
<td style="text-align:right;">
0.9940
</td>
<td style="text-align:right;">
0.9191
</td>
<td style="text-align:right;">
0.8566
</td>
<td style="text-align:right;">
0.9816
</td>
</tr>
<tr>
<td style="text-align:left;">
07
</td>
<td style="text-align:right;">
0.9474
</td>
<td style="text-align:right;">
0.8019
</td>
<td style="text-align:right;">
0.7076
</td>
<td style="text-align:right;">
0.8962
</td>
</tr>
<tr>
<td style="text-align:left;">
11
</td>
<td style="text-align:right;">
0.8631
</td>
<td style="text-align:right;">
0.4277
</td>
<td style="text-align:right;">
0.3056
</td>
<td style="text-align:right;">
0.5498
</td>
</tr>
<tr>
<td style="text-align:left;">
12
</td>
<td style="text-align:right;">
0.0480
</td>
<td style="text-align:right;">
0.0292
</td>
<td style="text-align:right;">
0.0120
</td>
<td style="text-align:right;">
0.0463
</td>
</tr>
</tbody>
</table>
<p>calculating the weights for each domain.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="preparing-inputs-for-stan.html#cb58-1" tabindex="-1"></a>pesos <span class="ot">&lt;-</span> temp <span class="sc">%&gt;%</span> </span>
<span id="cb58-2"><a href="preparing-inputs-for-stan.html#cb58-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">W_i =</span> total_pp <span class="sc">/</span> dam_pp) <span class="sc">%&gt;%</span> </span>
<span id="cb58-3"><a href="preparing-inputs-for-stan.html#cb58-3" tabindex="-1"></a>  <span class="fu">select</span>(dam2, W_i)</span>
<span id="cb58-4"><a href="preparing-inputs-for-stan.html#cb58-4" tabindex="-1"></a><span class="fu">tba</span>(pesos <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span></code></pre></div>
<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
dam2
</th>
<th style="text-align:right;">
W_i
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
0102
</td>
<td style="text-align:right;">
0.2980
</td>
</tr>
<tr>
<td style="text-align:left;">
0103
</td>
<td style="text-align:right;">
0.2995
</td>
</tr>
<tr>
<td style="text-align:left;">
0202
</td>
<td style="text-align:right;">
0.0763
</td>
</tr>
<tr>
<td style="text-align:left;">
0203
</td>
<td style="text-align:right;">
0.0616
</td>
</tr>
<tr>
<td style="text-align:left;">
0205
</td>
<td style="text-align:right;">
0.0623
</td>
</tr>
<tr>
<td style="text-align:left;">
0212
</td>
<td style="text-align:right;">
0.1021
</td>
</tr>
<tr>
<td style="text-align:left;">
0301
</td>
<td style="text-align:right;">
0.4448
</td>
</tr>
<tr>
<td style="text-align:left;">
0302
</td>
<td style="text-align:right;">
0.5552
</td>
</tr>
<tr>
<td style="text-align:left;">
0401
</td>
<td style="text-align:right;">
0.6106
</td>
</tr>
<tr>
<td style="text-align:left;">
0402
</td>
<td style="text-align:right;">
0.3894
</td>
</tr>
</tbody>
</table>
<ol start="5" style="list-style-type: decimal">
<li>Perform FH Benchmark Estimation</li>
</ol>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="preparing-inputs-for-stan.html#cb59-1" tabindex="-1"></a>estimacionesBench <span class="ot">&lt;-</span> estimacionesPre <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="preparing-inputs-for-stan.html#cb59-2" tabindex="-1"></a>  <span class="fu">left_join</span>(R_dam2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;dam&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="preparing-inputs-for-stan.html#cb59-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">theta_pred_RBench =</span> R_dam_RB <span class="sc">*</span> theta_pred) <span class="sc">%&gt;%</span></span>
<span id="cb59-4"><a href="preparing-inputs-for-stan.html#cb59-4" tabindex="-1"></a>  <span class="fu">left_join</span>(pesos) <span class="sc">%&gt;%</span> </span>
<span id="cb59-5"><a href="preparing-inputs-for-stan.html#cb59-5" tabindex="-1"></a>  <span class="fu">select</span>(dam, dam2, W_i, theta_pred, theta_pred_RBench)  </span>
<span id="cb59-6"><a href="preparing-inputs-for-stan.html#cb59-6" tabindex="-1"></a></span>
<span id="cb59-7"><a href="preparing-inputs-for-stan.html#cb59-7" tabindex="-1"></a>  <span class="fu">tba</span>(estimacionesBench <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span></code></pre></div>
<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
dam
</th>
<th style="text-align:left;">
dam2
</th>
<th style="text-align:right;">
W_i
</th>
<th style="text-align:right;">
theta_pred
</th>
<th style="text-align:right;">
theta_pred_RBench
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
01
</td>
<td style="text-align:left;">
0102
</td>
<td style="text-align:right;">
0.2980
</td>
<td style="text-align:right;">
0.9832
</td>
<td style="text-align:right;">
1.0811
</td>
</tr>
<tr>
<td style="text-align:left;">
01
</td>
<td style="text-align:left;">
0103
</td>
<td style="text-align:right;">
0.2995
</td>
<td style="text-align:right;">
0.8759
</td>
<td style="text-align:right;">
0.9632
</td>
</tr>
<tr>
<td style="text-align:left;">
02
</td>
<td style="text-align:left;">
0202
</td>
<td style="text-align:right;">
0.0763
</td>
<td style="text-align:right;">
0.9391
</td>
<td style="text-align:right;">
1.0478
</td>
</tr>
<tr>
<td style="text-align:left;">
02
</td>
<td style="text-align:left;">
0203
</td>
<td style="text-align:right;">
0.0616
</td>
<td style="text-align:right;">
0.8117
</td>
<td style="text-align:right;">
0.9057
</td>
</tr>
<tr>
<td style="text-align:left;">
02
</td>
<td style="text-align:left;">
0205
</td>
<td style="text-align:right;">
0.0623
</td>
<td style="text-align:right;">
0.9645
</td>
<td style="text-align:right;">
1.0762
</td>
</tr>
<tr>
<td style="text-align:left;">
02
</td>
<td style="text-align:left;">
0212
</td>
<td style="text-align:right;">
0.1021
</td>
<td style="text-align:right;">
0.8303
</td>
<td style="text-align:right;">
0.9264
</td>
</tr>
<tr>
<td style="text-align:left;">
03
</td>
<td style="text-align:left;">
0301
</td>
<td style="text-align:right;">
0.4448
</td>
<td style="text-align:right;">
0.9419
</td>
<td style="text-align:right;">
0.9363
</td>
</tr>
<tr>
<td style="text-align:left;">
03
</td>
<td style="text-align:left;">
0302
</td>
<td style="text-align:right;">
0.5552
</td>
<td style="text-align:right;">
0.9109
</td>
<td style="text-align:right;">
0.9054
</td>
</tr>
<tr>
<td style="text-align:left;">
04
</td>
<td style="text-align:left;">
0401
</td>
<td style="text-align:right;">
0.6106
</td>
<td style="text-align:right;">
0.8079
</td>
<td style="text-align:right;">
0.8072
</td>
</tr>
<tr>
<td style="text-align:left;">
04
</td>
<td style="text-align:left;">
0402
</td>
<td style="text-align:right;">
0.3894
</td>
<td style="text-align:right;">
0.8307
</td>
<td style="text-align:right;">
0.8299
</td>
</tr>
</tbody>
</table>
<ol start="6" style="list-style-type: decimal">
<li>Validation: FH Estimation with Benchmark</li>
</ol>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="preparing-inputs-for-stan.html#cb60-1" tabindex="-1"></a>estimacionesBench <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(dam) <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="preparing-inputs-for-stan.html#cb60-2" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">theta_reg_RB =</span> <span class="fu">sum</span>(W_i <span class="sc">*</span> theta_pred_RBench)) <span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="preparing-inputs-for-stan.html#cb60-3" tabindex="-1"></a>  <span class="fu">left_join</span>(directoDam, <span class="at">by =</span> <span class="st">&quot;dam&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb60-4"><a href="preparing-inputs-for-stan.html#cb60-4" tabindex="-1"></a>  <span class="fu">tba</span>()</span></code></pre></div>
<table class="table table-striped lightable-classic" style="width: auto !important; margin-left: auto; margin-right: auto; font-family: Arial Narrow; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
dam
</th>
<th style="text-align:right;">
theta_reg_RB
</th>
<th style="text-align:right;">
theta_dir
</th>
<th style="text-align:right;">
theta_dir_low
</th>
<th style="text-align:right;">
theta_dir_upp
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
01
</td>
<td style="text-align:right;">
0.9926
</td>
<td style="text-align:right;">
0.9926
</td>
<td style="text-align:right;">
0.9848
</td>
<td style="text-align:right;">
1.0004
</td>
</tr>
<tr>
<td style="text-align:left;">
02
</td>
<td style="text-align:right;">
0.9760
</td>
<td style="text-align:right;">
0.9760
</td>
<td style="text-align:right;">
0.9638
</td>
<td style="text-align:right;">
0.9881
</td>
</tr>
<tr>
<td style="text-align:left;">
03
</td>
<td style="text-align:right;">
0.9191
</td>
<td style="text-align:right;">
0.9191
</td>
<td style="text-align:right;">
0.8566
</td>
<td style="text-align:right;">
0.9816
</td>
</tr>
<tr>
<td style="text-align:left;">
04
</td>
<td style="text-align:right;">
0.8160
</td>
<td style="text-align:right;">
0.8160
</td>
<td style="text-align:right;">
0.7742
</td>
<td style="text-align:right;">
0.8578
</td>
</tr>
<tr>
<td style="text-align:left;">
05
</td>
<td style="text-align:right;">
0.7486
</td>
<td style="text-align:right;">
0.7486
</td>
<td style="text-align:right;">
0.6943
</td>
<td style="text-align:right;">
0.8029
</td>
</tr>
<tr>
<td style="text-align:left;">
06
</td>
<td style="text-align:right;">
0.9419
</td>
<td style="text-align:right;">
0.9419
</td>
<td style="text-align:right;">
0.8993
</td>
<td style="text-align:right;">
0.9844
</td>
</tr>
<tr>
<td style="text-align:left;">
07
</td>
<td style="text-align:right;">
0.8019
</td>
<td style="text-align:right;">
0.8019
</td>
<td style="text-align:right;">
0.7076
</td>
<td style="text-align:right;">
0.8962
</td>
</tr>
<tr>
<td style="text-align:left;">
08
</td>
<td style="text-align:right;">
0.5933
</td>
<td style="text-align:right;">
0.5933
</td>
<td style="text-align:right;">
0.4904
</td>
<td style="text-align:right;">
0.6961
</td>
</tr>
<tr>
<td style="text-align:left;">
09
</td>
<td style="text-align:right;">
0.8628
</td>
<td style="text-align:right;">
0.8628
</td>
<td style="text-align:right;">
0.8167
</td>
<td style="text-align:right;">
0.9090
</td>
</tr>
<tr>
<td style="text-align:left;">
10
</td>
<td style="text-align:right;">
0.7379
</td>
<td style="text-align:right;">
0.7379
</td>
<td style="text-align:right;">
0.6348
</td>
<td style="text-align:right;">
0.8410
</td>
</tr>
<tr>
<td style="text-align:left;">
11
</td>
<td style="text-align:right;">
0.4277
</td>
<td style="text-align:right;">
0.4277
</td>
<td style="text-align:right;">
0.3056
</td>
<td style="text-align:right;">
0.5498
</td>
</tr>
<tr>
<td style="text-align:left;">
12
</td>
<td style="text-align:right;">
0.0292
</td>
<td style="text-align:right;">
0.0292
</td>
<td style="text-align:right;">
0.0120
</td>
<td style="text-align:right;">
0.0463
</td>
</tr>
<tr>
<td style="text-align:left;">
13
</td>
<td style="text-align:right;">
0.6461
</td>
<td style="text-align:right;">
0.6461
</td>
<td style="text-align:right;">
0.5226
</td>
<td style="text-align:right;">
0.7696
</td>
</tr>
<tr>
<td style="text-align:left;">
14
</td>
<td style="text-align:right;">
0.8792
</td>
<td style="text-align:right;">
0.8792
</td>
<td style="text-align:right;">
0.8376
</td>
<td style="text-align:right;">
0.9207
</td>
</tr>
</tbody>
</table>
</div>
<div id="results-validation" class="section level3 hasAnchor" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> Results Validation<a href="preparing-inputs-for-stan.html#results-validation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This code conducts data analysis and visualization using the <code>ggplot2</code> library. Specifically, it merges two <code>data frames</code> using the <code>left_join()</code> function, groups the data by the <code>dam</code> variable, and performs some operations to transform the <code>thetaFH</code> and <code>theta_pred_RBench</code> variables. Afterwards, it utilizes the <code>gather()</code> function to organize the data in a long format and visualizes it with <code>ggplot()</code>.</p>
<p>The resulting visualization displays points in different shapes and colors, representing various estimation methods. Additionally, it includes two dashed lines that depict the upper and lower confidence intervals for the observed values in the <code>theta_dir</code> variable.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="preparing-inputs-for-stan.html#cb61-1" tabindex="-1"></a>temp <span class="ot">&lt;-</span> estimacionesBench <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(</span>
<span id="cb61-2"><a href="preparing-inputs-for-stan.html#cb61-2" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb61-3"><a href="preparing-inputs-for-stan.html#cb61-3" tabindex="-1"></a>data_dir <span class="sc">%&gt;%</span> <span class="fu">select</span>(dam2, <span class="at">thetaFH =</span> pred_arcoseno),</span>
<span id="cb61-4"><a href="preparing-inputs-for-stan.html#cb61-4" tabindex="-1"></a>data_syn <span class="sc">%&gt;%</span> <span class="fu">select</span>(dam2, <span class="at">thetaFH =</span> pred_arcoseno))) <span class="sc">%&gt;%</span> </span>
<span id="cb61-5"><a href="preparing-inputs-for-stan.html#cb61-5" tabindex="-1"></a><span class="fu">group_by</span>(dam) <span class="sc">%&gt;%</span> </span>
<span id="cb61-6"><a href="preparing-inputs-for-stan.html#cb61-6" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">thetaFH =</span> <span class="fu">sum</span>(W_i <span class="sc">*</span> theta_pred),</span>
<span id="cb61-7"><a href="preparing-inputs-for-stan.html#cb61-7" tabindex="-1"></a>          <span class="at">theta_RBench =</span> <span class="fu">sum</span>(W_i <span class="sc">*</span> theta_pred_RBench)</span>
<span id="cb61-8"><a href="preparing-inputs-for-stan.html#cb61-8" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span>   </span>
<span id="cb61-9"><a href="preparing-inputs-for-stan.html#cb61-9" tabindex="-1"></a><span class="fu">left_join</span>(directoDam, <span class="at">by =</span> <span class="st">&quot;dam&quot;</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb61-10"><a href="preparing-inputs-for-stan.html#cb61-10" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span>
<span id="cb61-11"><a href="preparing-inputs-for-stan.html#cb61-11" tabindex="-1"></a></span>
<span id="cb61-12"><a href="preparing-inputs-for-stan.html#cb61-12" tabindex="-1"></a>temp <span class="sc">%&lt;&gt;%</span> <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">&quot;Metodo&quot;</span>,<span class="at">value =</span> <span class="st">&quot;Estimacion&quot;</span>,</span>
<span id="cb61-13"><a href="preparing-inputs-for-stan.html#cb61-13" tabindex="-1"></a>                <span class="sc">-</span>id, <span class="sc">-</span>dam, <span class="sc">-</span>theta_dir_upp, <span class="sc">-</span>theta_dir_low)</span>
<span id="cb61-14"><a href="preparing-inputs-for-stan.html#cb61-14" tabindex="-1"></a></span>
<span id="cb61-15"><a href="preparing-inputs-for-stan.html#cb61-15" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> temp, <span class="fu">aes</span>(<span class="at">x =</span> id, <span class="at">y =</span> Estimacion, <span class="at">shape =</span> Metodo)) <span class="sc">+</span></span>
<span id="cb61-16"><a href="preparing-inputs-for-stan.html#cb61-16" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> Metodo), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb61-17"><a href="preparing-inputs-for-stan.html#cb61-17" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> theta_dir_low), <span class="at">linetype  =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb61-18"><a href="preparing-inputs-for-stan.html#cb61-18" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> theta_dir_upp),  <span class="at">linetype  =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb61-19"><a href="preparing-inputs-for-stan.html#cb61-19" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="dv">20</span>) <span class="sc">+</span> </span>
<span id="cb61-20"><a href="preparing-inputs-for-stan.html#cb61-20" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> temp<span class="sc">$</span>id,</span>
<span id="cb61-21"><a href="preparing-inputs-for-stan.html#cb61-21" tabindex="-1"></a>    <span class="at">labels =</span>  temp<span class="sc">$</span>dam) <span class="sc">+</span></span>
<span id="cb61-22"><a href="preparing-inputs-for-stan.html#cb61-22" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">x =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb61-23"><a href="preparing-inputs-for-stan.html#cb61-23" tabindex="-1"></a></span>
<span id="cb61-24"><a href="preparing-inputs-for-stan.html#cb61-24" tabindex="-1"></a><span class="co"># ggsave(plot = p1,</span></span>
<span id="cb61-25"><a href="preparing-inputs-for-stan.html#cb61-25" tabindex="-1"></a><span class="co">#        filename = &quot;Recursos/04_FH_Arcosin/08_validar_bench.png&quot;,width = 16,height = 12)</span></span>
<span id="cb61-26"><a href="preparing-inputs-for-stan.html#cb61-26" tabindex="-1"></a>p1 </span></code></pre></div>
<p><img src="Recursos/04_FH_Arcosin/08_validar_bench.png" /></p>
<p>¡Entendido! Aquí tienes la traducción:</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="modelos-de-área---transformación-arcoseno..html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="poverty-map.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/psirusteam/2021ASDA/04_S1_Fay_Herriot_arcosin.qmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Area models for estimating poverty and labor market indicators.pdf", "Area models for estimating poverty and labor market indicators.epub", "Area models for estimating poverty and labor market indicators.mobi"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"tconfig": null
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
